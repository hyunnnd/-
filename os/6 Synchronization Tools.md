
# Producer/Consumer Problem

## ê°œìš”
- **Producer**: ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ë²„í¼ì— ì €ì¥í•˜ê³ ì í•¨
- **Consumer**: ë²„í¼ì— ìˆëŠ” ë°ì´í„°ë¥¼ êº¼ë‚´ì–´ ì‚¬ìš©í•¨

## êµ¬ì„± ìš”ì†Œ
- **Buffer (Shared Memory)**: Producerì™€ Consumer ê°„ ê³µìœ ë˜ëŠ” ë©”ëª¨ë¦¬ ê³µê°„
  - ì¼ë°˜ì ìœ¼ë¡œ **circular queue**(ì›í˜• í)ë¡œ êµ¬í˜„

## ë™ì‘ ë°©ì‹
```text
Producer â†’ [info.] â†’ Buffer (Shared Memory) â†’ [info.] â†’ Consumer
```

## ì˜ˆì‹œ: ë‹¤ì¤‘ ìŠ¤ë ˆë“œ ì›¹ ì„œë²„

- **Producer**: HTTP ìš”ì²­ì„ ì‘ì—… íì— ë„£ìŒ
- **Consumer**: ì‘ì—… íì—ì„œ ìš”ì²­ì„ êº¼ë‚´ì–´ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œë“¤



# Concurrent Access of Shared Data

## Producer ì½”ë“œ
```c
while (true) {
    while (counter == BUFFER_SIZE);
    buffer[in] = nextProduced;
    in = (in + 1) % BUFFERSIZE;
    counter++;  // ê³µìœ  ìì› ë³€ê²½
}
```
## Consumer ì½”ë“œ
```c
while (true) {
    while (counter == 0);
    nextConsumed = buffer[out];
    out = (out + 1) % BUFFER_SIZE;
    counter--;  // ê³µìœ  ìì› ë³€ê²½
}

```


## ë¬¸ì œ ìƒí™©

- `counter` ë³€ìˆ˜ëŠ” **ê³µìœ  ìì›(shared variable)**ì´ë©°, **ë™ì‹œì— ì ‘ê·¼**ë¨
- ì´ˆê¸°ê°’ì´ 5ì¸ ìƒí™©ì—ì„œ:
    - ProducerëŠ” `counter++` ìˆ˜í–‰
    - ConsumerëŠ” `counter--` ìˆ˜í–‰
- ì´ìƒì ìœ¼ë¡œëŠ” ê²°ê³¼ê°€ 5ë¡œ ìœ ì§€ë˜ì–´ì•¼ í•˜ì§€ë§Œ, **ê²½ìŸ ì¡°ê±´(race condition)** ë°œìƒ ì‹œ ì •í™•í•œ ê²°ê³¼ ë³´ì¥ ë¶ˆê°€



# ë™ê¸°í™” ë¬¸ì œ (Synchronization Problem)

### `counter++` êµ¬í˜„
registerâ‚ = counter  
registerâ‚ = registerâ‚ + 1  
counter = registerâ‚

### `counter--` êµ¬í˜„
registerâ‚‚ = counter  
registerâ‚‚ = registerâ‚‚ - 1  
counter = registerâ‚‚

### ë¬¸ì œ ìƒí™©: ëª…ë ¹ì–´ê°€ ì„ì—¬ ì‹¤í–‰ë  ê²½ìš° (interleaved execution)

| Producer                              | Consumer                              |
| ------------------------------------- | ------------------------------------- |
| registerâ‚ = counter *(registerâ‚ = 5)* | registerâ‚‚ = counter *(registerâ‚‚ = 5)* |
| registerâ‚ = registerâ‚ + 1 *(= 6)*     | registerâ‚‚ = registerâ‚‚ - 1 *(= 4)*     |
| counter = registerâ‚ *(counter = 6)*   | counter = registerâ‚‚ *(counter = 4)*   |

> **counter can be 4 or 6 !**


# ë™ê¸°í™” ë¬¸ì œ (Synchronization Problem)

## Race condition (ê²½ìŸ ì¡°ê±´)
- ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ë™ì¼í•œ ë°ì´í„°ë¥¼ ì ‘ê·¼ ë° ì¡°ì‘í•˜ëŠ” ìƒí™©
- ì‹¤í–‰ ê²°ê³¼ê°€ ì ‘ê·¼ì´ ì¼ì–´ë‚˜ëŠ” **ìˆœì„œ**ì— ë”°ë¼ ë‹¬ë¼ì§

## Synchronization (ë™ê¸°í™”)
- ì‚¬ê±´ë“¤ì˜ ë°œìƒì„ ì‹œê°„ì— ë§ì¶° **ì¼ê´€ë˜ê²Œ ë™ì‘í•˜ë„ë¡ ì¡°ì •**í•˜ëŠ” ê²ƒ
- í•œ ë²ˆì— **ì˜¤ì§ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œ ê³µìœ  ë°ì´í„°ì— ì ‘ê·¼**í•˜ë„ë¡ ë³´ì¥


# ì„ê³„ êµ¬ì—­ (Critical Section)

Critical section problemì€ í”„ë¡œì„¸ìŠ¤ê°€ ë°ì´í„°ë¥¼ í˜‘ë ¥ì ìœ¼ë¡œ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ í™œë™ì„ ë™ê¸°í™”í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œí† ì½œì„ ì„¤ê³„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤
## ê°œìš”
- nê°œì˜ í”„ë¡œì„¸ìŠ¤ ì§‘í•© {pâ‚€, pâ‚, ..., pâ‚™â‚‹â‚}ë¥¼ ê³ ë ¤
- ê° í”„ë¡œì„¸ìŠ¤ëŠ” **ì„ê³„ êµ¬ì—­(Critical Section)**ì´ë¼ëŠ” ì½”ë“œ ì˜ì—­ì„ ê°€ì§

## ì„ê³„ êµ¬ì—­ì˜ íŠ¹ì§•
- í•´ë‹¹ êµ¬ì—­ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥:
  - ê³µìš© ë³€ìˆ˜ ìˆ˜ì •
  - í…Œì´ë¸” ê°±ì‹ 
  - íŒŒì¼ ì“°ê¸° ë“±
- í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„ êµ¬ì—­ì— ë“¤ì–´ê°€ë©´, **ë‹¤ë¥¸ ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë„ ë™ì‹œì— í•´ë‹¹ ì„ê³„ êµ¬ì—­ì— ë“¤ì–´ê°€ì„œëŠ” ì•ˆ ë¨**

## í”„ë¡œì„¸ìŠ¤ íë¦„
- **Entry Section** â†’ **Critical Section** â†’ **Exit Section** â†’ **Remainder Section**

> ê³µìš© ë°ì´í„° ì ‘ê·¼ ì‹œ ë°˜ë“œì‹œ ì„ê³„ êµ¬ì—­ ë³´í˜¸ í•„ìš”

## ê° êµ¬ì—­ ì„¤ëª…

- **Entry section**: ì„ê³„ êµ¬ì—­ ì§„ì…ì„ ìš”ì²­í•˜ëŠ” ì½”ë“œ ì˜ì—­
- **Critical section**: ê³µìœ  ìì›(ê³µìš© ë³€ìˆ˜, íŒŒì¼ ë“±)ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì½”ë“œ ì˜ì—­
- **Exit section**: ì„ê³„ êµ¬ì—­ì—ì„œ ë‚˜ì™”ìŒì„ ì•Œë¦¬ëŠ” ì½”ë“œ ì˜ì—­
- **Remainder section**: ê³µìœ  ìì›ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ë‚˜ë¨¸ì§€ ì½”ë“œ ì˜ì—­



# ìš´ì˜ì²´ì œì—ì„œì˜ ì„ê³„ êµ¬ì—­ ì²˜ë¦¬ (Critical-Section Handling in OS)

## ì˜ˆì‹œ: PID í• ë‹¹ ì‹œ ë°œìƒí•˜ëŠ” ê²½ìŸ ì¡°ê±´ (Race Condition)

- í”„ë¡œì„¸ìŠ¤ **Pâ‚€**ì™€ **Pâ‚**ì´ `fork()` ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•¨
- ì´ë•Œ ì»¤ë„ ë³€ìˆ˜ì¸ `next_available_pid`ì— ê²½ìŸ ì¡°ê±´ì´ ë°œìƒí•¨  
  â†’ ì´ ë³€ìˆ˜ëŠ” ë‹¤ìŒì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **í”„ë¡œì„¸ìŠ¤ ì‹ë³„ì(pid)**ë¥¼ ì˜ë¯¸í•¨
- **ìƒí˜¸ ë°°ì œ(mutual exclusion)**ê°€ ì—†ë‹¤ë©´,  
  ë™ì¼í•œ `pid`ê°€ ë‘ ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— **ë™ì‹œì— í• ë‹¹**ë  ìˆ˜ ìˆìŒ!
![[Pasted image 20250519122246.png]]

# ìš´ì˜ì²´ì œì—ì„œì˜ ì„ê³„ êµ¬ì—­ ì²˜ë¦¬ ë°©ì‹

## ìš´ì˜ì²´ì œì—ì„œ ì„ê³„ êµ¬ì—­ì„ ì²˜ë¦¬í•˜ëŠ” ë‘ ê°€ì§€ ì¼ë°˜ì ì¸ ì ‘ê·¼ ë°©ì‹

### 1. Non-preemptive (ë¹„ì„ ì í˜• ì»¤ë„)
- ì»¤ë„ ëª¨ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ëŠ” **ì„ ì (preempt)**ë˜ì§€ ì•ŠìŒ
- ì»¤ë„ ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ê°€ ë  ë•Œê¹Œì§€ ê³„ì† ì‹¤í–‰ë¨:
  - ì»¤ë„ ëª¨ë“œ ì¢…ë£Œ
  - ë¸”ë¡œí‚¹ ë°œìƒ
  - ìë°œì ìœ¼ë¡œ CPU ì–‘ë„
- ê²°ê³¼ì ìœ¼ë¡œ, ì»¤ë„ ëª¨ë“œì—ì„œëŠ” **ê²½ìŸ ì¡°ê±´ì´ ê±°ì˜ ì—†ìŒ**

### 2. Preemptive kernels (ì„ ì í˜• ì»¤ë„)
- ì»¤ë„ ëª¨ë“œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë„ **ì„ ì  ê°€ëŠ¥**
- ë” ë¹ ë¥´ê²Œ ë°˜ì‘í•¨:
  - ì»¤ë„ ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ë„ˆë¬´ ì˜¤ë˜ CPUë¥¼ ì ìœ í•  ìœ„í—˜ì´ ì¤„ì–´ë“¦
- **ì‹¤ì‹œê°„ í”„ë¡œì„¸ìŠ¤(real-time process)**ì— ë” ì í•©í•¨


# ë½(Locks): ê¸°ë³¸ ê°œë…

## ëª©ì 
- **ì„ê³„ êµ¬ì—­(Critical Section)**ì´ ë§ˆì¹˜ **ë‹¨ì¼ ì›ìì  ëª…ë ¹(atomic instruction)**ì²˜ëŸ¼ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•¨

## ì˜ˆì‹œ: ê³µìœ  ë³€ìˆ˜ ì—…ë°ì´íŠ¸
```c
balance = balance + 1;
```

## ì„ê³„ êµ¬ì—­ì„ ë³´í˜¸í•˜ëŠ” ì½”ë“œ ì¶”ê°€
```c
lock_t mutex;  // ì „ì—­ìœ¼ë¡œ í• ë‹¹ëœ ë½ ë³€ìˆ˜ â€˜mutexâ€™

lock(&mutex);
balance = balance + 1;
unlock(&mutex);
```
## ë½ ë³€ìˆ˜ (ì˜ˆ: `mutex`)ì˜ ìƒíƒœ

- **Available (unlocked / free)**:  
    ì–´ë–¤ ìŠ¤ë ˆë“œë„ ë½ì„ ì ìœ í•˜ì§€ ì•Šì€ ìƒíƒœ
- **Acquired (locked / held)**:  
    ì •í™•íˆ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ë½ì„ ì ìœ í•˜ê³  ìˆìœ¼ë©°, í•´ë‹¹ ìŠ¤ë ˆë“œëŠ” ì„ê³„ êµ¬ì—­ì— ìˆìŒ


# ë½(Locks): ê¸°ë³¸ ê°œë…

## lock()
- ë½ì„ íšë“í•˜ë ¤ê³  ì‹œë„í•¨
- ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ë½ì„ ì†Œìœ í•˜ê³  ìˆì§€ ì•Šë‹¤ë©´, í˜„ì¬ ìŠ¤ë ˆë“œê°€ ë½ì„ íšë“í•¨
- ì„ê³„ êµ¬ì—­ì— ì§„ì…
  - ì´ ìŠ¤ë ˆë“œëŠ” **ë½ì˜ ì†Œìœ ì(owner)**ë¼ê³  ë¶ˆë¦¼
- ë½ì„ ë³´ìœ í•œ ìŠ¤ë ˆë“œê°€ ì„ê³„ êµ¬ì—­ì— ìˆëŠ” ë™ì•ˆ,  
  ë‹¤ë¥¸ ìŠ¤ë ˆë“œëŠ” ê·¸ ì„ê³„ êµ¬ì—­ì— ì§„ì…í•  ìˆ˜ ì—†ìŒ

```c
lock(&mutex);
balance = balance + 1;
unlock(&mutex);
```
## unlock()
- ë½ì˜ ì†Œìœ ìê°€ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´, í•´ë‹¹ ë½ì€ **ë‹¤ì‹œ ì‚¬ìš© ê°€ëŠ¥(free)** ìƒíƒœê°€ ë¨

![[Pasted image 20250522121136.png]]

![[Pasted image 20250522121146.png]]

# ë½(Lock)ì˜ ìš”êµ¬ ì¡°ê±´

## 1. ìƒí˜¸ ë°°ì œ (Mutual Exclusion)
- ë½ì´ **ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì„ê³„ êµ¬ì—­ì— ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë°©ì§€**í•˜ëŠ”ê°€?
- ì„ê³„ êµ¬ì—­ì— í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì§„ì…í•´ ìˆìœ¼ë©´, ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì§„ì…í•  ìˆ˜ ì—†ì–´ì•¼ í•¨

## 2. ê³µì •ì„± (Fairness)
- ë½ì„ ì–»ìœ¼ë ¤ëŠ” **ê° ìŠ¤ë ˆë“œê°€ ê³µì •í•˜ê²Œ ê¸°íšŒë¥¼ ì–»ëŠ”ê°€?**
- ê´€ë ¨ ê°œë…:
  - **ê¸°ì•„(Starvation)**: íŠ¹ì • ìŠ¤ë ˆë“œê°€ ê³„ì† ë½ì„ ì–»ì§€ ëª»í•˜ëŠ” í˜„ìƒ
  - **ì§„í–‰ì„±(Progress)** ë° **ìœ í•œ ëŒ€ê¸°(Bounded Waiting)**

### ì •ì˜ (Operating System Conceptsì—ì„œ ë°œì·Œ)
- **Mutual Exclusion**: í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„ êµ¬ì—­ì„ ì‹¤í–‰ ì¤‘ì´ë©´, ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì§„ì… ë¶ˆê°€
- **Progress**: ì„ê³„ êµ¬ì—­ì„ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ì—†ë‹¤ë©´,  
  ë‹¤ìŒìœ¼ë¡œ ì§„ì…í•  í”„ë¡œì„¸ìŠ¤ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒì´ **ë¬´ê¸°í•œ ì—°ê¸°ë˜ì–´ì„œëŠ” ì•ˆ ë¨**
- **Bounded Waiting**: íŠ¹ì • í”„ë¡œì„¸ìŠ¤ê°€ ë½ì„ ìš”ì²­í•œ ì´í›„,  
  ê·¸ ìš”ì²­ì´ í—ˆìš©ë˜ê¸°ê¹Œì§€ **ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ëª‡ ë²ˆ ì„ê³„ êµ¬ì—­ì— ì§„ì…í•  ìˆ˜ ìˆëŠ”ì§€ ì œí•œì´ ìˆì–´ì•¼ í•¨**

## 3. ì„±ëŠ¥ (Performance)
- ë½ ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì¶”ê°€ë˜ëŠ” **ì‹œê°„ ì˜¤ë²„í—¤ë“œ**ëŠ” ì–¼ë§ˆë‚˜ ë˜ëŠ”ê°€?


## ğŸ“Œ Controlling Interrupts

### ğŸ”’ Disable interrupts for critical sections

- ìƒí˜¸ ë°°ì œë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ ê°€ì¥ ì´ˆê¸°ì˜ í•´ê²°ì±… ì¤‘ í•˜ë‚˜
- **ë‹¨ì¼ í”„ë¡œì„¸ì„œ(single-processor)** ì‹œìŠ¤í…œì„ ìœ„í•´ ê³ ì•ˆë¨

`void lock() {     DisableInterrupts(); } void unlock() {     EnableInterrupts(); }`

### âš ï¸ ë¬¸ì œì 

- ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ **ì‹ ë¢°**ê°€ ë„ˆë¬´ ë§ì´ ìš”êµ¬ë¨
    - íƒìš•ì (greedy) ë˜ëŠ” ì•…ì˜ì ì¸(malicious) í”„ë¡œê·¸ë¨ì´ í”„ë¡œì„¸ì„œë¥¼ ë…ì í•  ìˆ˜ ìˆìŒ

- **ë‹¤ì¤‘ í”„ë¡œì„¸ì„œ(multiprocessor)**ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•ŠìŒ
    - ì¸í„°ëŸ½íŠ¸ë¥¼ ë§ˆìŠ¤í‚¹í•˜ê±°ë‚˜ í•´ì œí•˜ëŠ” ì½”ë“œê°€ **í˜„ëŒ€ CPUì—ì„œ ëŠë¦¬ê²Œ ì‹¤í–‰**ë¨

![[Pasted image 20250522121847.png]]


## ğŸ“Œ Using a Flag

### â— ë¬¸ì œ 1: **ìƒí˜¸ ë°°ì œ ì—†ìŒ (No Mutual Exclusion)**

> ì´ˆê¸° ìƒíƒœ: `flag = 0`ì´ë¼ê³  ê°€ì •
#### Thread 1
`call lock() while (flag == 1)     // spin // context switch ë°œìƒ`
#### Thread 2
`call lock() while (flag == 1) flag = 1;  // ë™ì‹œì— ì„¤ì •ë¨! // context switch ë°œìƒ`

ê²°ê³¼:
`flag = 1;  // => ë‘˜ ë‹¤ ì§„ì… ê°€ëŠ¥í•˜ê²Œ ë˜ì–´ ìƒí˜¸ ë°°ì œê°€ ê¹¨ì§`

### â— ë¬¸ì œ 2: **Spin-waiting**

- ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ **ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ CPU ì‹œê°„ ë‚­ë¹„**

### âœ… í•´ê²°ì±…: **í•˜ë“œì›¨ì–´ì—ì„œ ì§€ì›í•˜ëŠ” ì›ìì  ëª…ë ¹ì´ í•„ìš”í•¨**

- `Test-and-Set` ëª…ë ¹ (atomic exchangeë¼ê³ ë„ í•¨)


## ğŸ” Test-And-Set

### âœ… ê°„ë‹¨í•œ ë½(lock) ìƒì„± ì§€ì›ì„ ìœ„í•œ ëª…ë ¹ì–´

`int TestAndSet(int *ptr, int new) {     int old = *ptr;     // í˜„ì¬ ê°’ì„ ê°€ì ¸ì˜´     *ptr = new;         // ìƒˆë¡œìš´ ê°’ì„ ì €ì¥     return old;         // ê¸°ì¡´ ê°’ì„ ë°˜í™˜ }`

### ğŸ’¡ í•µì‹¬ ê°œë…

- `ptr`ì´ ê°€ë¦¬í‚¤ëŠ” **ê¸°ì¡´ ê°’ì„ ë°˜í™˜**í•¨
- í•´ë‹¹ ì£¼ì†Œì— **ìƒˆë¡œìš´ ê°’(new)ì„ ì„¤ì •**
- ì´ ì¼ë ¨ì˜ ì—°ì‚°ì€ **ì›ìì ìœ¼ë¡œ ìˆ˜í–‰ë¨ (atomic)**


![[Pasted image 20250522122310.png]]



## ğŸ” Evaluating Spin Locks

### âœ… **Correctness**: yes

- Spin lockì€ í•œ ë²ˆì— **í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì„ê³„ êµ¬ì—­ì— ì§„ì…**í•˜ë„ë¡ í—ˆìš©í•¨

### âš  **Fairness**: no

- Spin lockì€ **ê³µì •ì„±(fairness)ì„ ë³´ì¥í•˜ì§€ ì•ŠìŒ**
- ì–´ë–¤ ìŠ¤ë ˆë“œëŠ” **ë¬´í•œíˆ ëŒ€ê¸°(spin)**í•  ìˆ˜ë„ ìˆìŒ

### âš™ **Performance**

- ë‹¨ì¼ CPU í™˜ê²½ì—ì„œëŠ” **ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œê°€ í¼**
- **ìŠ¤ë ˆë“œ ìˆ˜ê°€ CPU ìˆ˜ì™€ ë¹„ìŠ·í•œ ê²½ìš°**, Spin lockì€ **ìƒë‹¹íˆ ì˜ ì‘ë™**í•¨ (_reasonably well_)



## ğŸ” Compare-And-Swap

### âœ… ë™ì‘ ì„¤ëª…

- ì£¼ì†Œ `ptr`ì´ ê°€ë¦¬í‚¤ëŠ” ê°’ì´ `expected`ì™€ ê°™ìœ¼ë©´ â†’ `ptr`ì— `new` ê°’ì„ ì €ì¥
- ê·¸ ì™¸ì˜ ê²½ìš° â†’ ë³€ê²½ ì—†ì´ **ê¸°ì¡´ ê°’ì„ ë°˜í™˜**


`int CompareAndSwap(int *ptr, int expected, int new) {     int actual = *ptr;     if (actual == expected)         *ptr = new;     return actual; }`

### ğŸ”’ Spin Lock ì˜ˆì‹œ (CAS ê¸°ë°˜)

`void lock(lock_t *lock) {     while (CompareAndSwap(&lock->flag, 0, 1) == 1)         ;  // spin }`

### ğŸ§  ì°¸ê³ 

- `cmpxchg` (compare-and-exchange): x86/x64ì—ì„œ CAS ëª…ë ¹ì„ êµ¬í˜„í•˜ëŠ” ì–´ì…ˆë¸”ë¦¬ ëª…ë ¹ì–´


