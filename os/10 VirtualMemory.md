## 📘Background (Virtual Memory)

- **명령어는 물리 메모리에 있어야 실행 가능함**
  - → 그렇다면 전체 프로그램을 메모리에 올려야 할까?

- **일부 코드는 실행 중 거의 사용되지 않음**
  - 예외 처리 코드
  - 필요 이상으로 큰 배열/리스트
  - 자주 호출되지 않는 서브루틴 등

- **대안**
  - 프로그램의 일부만 메모리에 올리고 실행하는 방식
  - → 가상 메모리 개념의 필요성 제시

- **프로그램을 부분적으로 메모리에 올려 실행할 수 있다면** 다음과 같은 이점이 있음:
  - 물리 메모리 크기에 의해 프로그램 실행이 제한되지 않음
  - 동시에 더 많은 프로그램을 실행 가능
  - 프로그램을 로드하거나 스왑하는 데 필요한 I/O 감소


## 📘 Virtual Memory

- **가상 메모리(Virtual Memory)**: 사용자 논리 메모리와 물리 메모리의 분리
- 장점:
  - 프로그램 일부만 메모리에 올려도 실행 가능
  - 논리 주소 공간이 물리 주소 공간보다 훨씬 클 수 있음
  - 여러 프로세스가 주소 공간을 공유 가능
  - 프로세스 생성 효율 향상 (예: Copy-on-Write)
  - 동시에 더 많은 프로그램 실행 가능
  - 프로그램 로드·스왑 시 I/O 비용 감소
  - ![[Pasted image 20250513141000.png]]

> ⬅ 그림 설명: 논리 메모리는 물리 메모리 및 보조 저장장치와 매핑되어 있음


## 📘 Virtual Address Space

- **가상 주소 공간(Virtual Address Space)**: 프로세스가 메모리에 저장되는 논리적 구조
- 특징:
  - 일반적으로 주소 0부터 시작하여 연속적인 주소로 구성
  - 실제 물리 메모리는 페이지 프레임 단위로 구성됨
  - MMU(Memory Management Unit)가 논리 주소를 물리 주소에 매핑
  - 프로그래머는 메모리 관리 부담을 덜 수 있음
  - 가상 주소 공간은 **희소(sparse)**할 수 있음
    - 예: 스택/힙이 확장되거나 동적 라이브러리 연결 시 중간 공간이 채워짐
![[Pasted image 20250513141303.png]]

> ⬅ 그림 설명: 코드, 데이터, 힙, 스택 영역으로 구성된 전형적인 가상 주소 공간 구조


## 📘Page Sharing

- 가상 메모리는 **두 개 이상의 프로세스가 파일과 메모리를 공유**할 수 있도록 함
- 공유 방식:
  - 시스템 라이브러리를 가상 주소 공간에 매핑하여 공유
  - 공유 메모리를 읽기/쓰기 가능한 페이지로 매핑하여 가상 주소 공간에 배치
  - `fork()` 호출 시 페이지를 공유하여 **프로세스 생성 속도 향상**


## 📘 Demand Paging

- **Demand Paging**: 페이지는 **실제로 필요할 때만 메모리에 적재**
  - 프로그램 실행 중 요구된 시점에 로딩됨
- 장점:
  - 스와핑 기반 페이징과 유사하지만 **불필요한 I/O 없음**
  - **적은 메모리 사용량**
  - **빠른 응답 시간**
  - **더 많은 사용자 수용 가능**
- 필요 조건:
  - 페이지가 **메모리에 있는지 디스크에 있는지 구분할 수 있는 하드웨어 지원** 필요
    - (→ valid-invalid 비트를 통한 페이지 상태 구분)
![[Pasted image 20250513142552.png]]
> ⬅ 그림 설명:
> - 논리 메모리에서 A~H 페이지가 존재
> - 페이지 테이블은 각 페이지가 **어느 프레임에 있고 유효한지** 나타냄
> - 유효하지 않은 페이지는 **백업 저장소(backing store)**에 있음


## 📘Page Table with Valid-Invalid Bit

- **유효/무효 비트(valid/invalid bit)**는 각 페이지가 물리 메모리에 존재하는지 여부를 나타냄

### 🟢 Valid
- 해당 페이지가 **물리 메모리에 존재**
- 접근 시 **정상적으로 실행됨**

### 🔴 Invalid
- 해당 페이지가:
  - 프로세스의 유효한 논리 주소 공간에 **속하지 않거나**
  - 아직 물리 메모리에 **로드되지 않음**
- 접근 시 **페이지 폴트(page fault)** 발생 → OS가 처리